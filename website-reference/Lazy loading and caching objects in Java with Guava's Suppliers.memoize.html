<!DOCTYPE html>
<!-- saved from url=(0106)https://www.stubbornjava.com/posts/lazy-loading-and-caching-objects-in-java-with-guava-s-suppliers-memoize -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="x-ua-compatible" content="ie=edge"> <meta name="description" content="Use Guava&#39;s Suppliers.memoize to lazy load and cache objects. Use Suppliers.memoizeWithExpiration to have an expireable cached object in Java."> <style class="anchorjs"></style><link rel="stylesheet" href="./Lazy loading and caching objects in Java with Guava&#39;s Suppliers.memoize_files/common-b7f04f76bf2f0d4baef8.css"> <script async="" src="./Lazy loading and caching objects in Java with Guava&#39;s Suppliers.memoize_files/analytics.js"></script><script type="text/javascript" src="./Lazy loading and caching objects in Java with Guava&#39;s Suppliers.memoize_files/common-b7f04f76bf2f0d4baef8.js" defer=""></script> <link rel="alternate" type="application/rss+xml" title="StubbornJava" href="https://www.stubbornjava.com/rss/feed"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@StubbornJava"> <meta name="twitter:title" content="Lazy loading and caching objects in Java with Guava&#39;s Suppliers.memoize"> <meta name="twitter:description" content="Use Guava&#39;s Suppliers.memoize to lazy load and cache objects. Use Suppliers.memoizeWithExpiration to have an expireable cached object in Java."> <meta name="twitter:image" content="https://www.stubbornjava.com/assets/images/PenguinHQ_compressed.png"> <title>Lazy loading and caching objects in Java with Guava's Suppliers.memoize</title> </head> <body data-new-gr-c-s-check-loaded="14.997.0" data-gr-ext-installed=""> <nav class="navbar navbar-inverse navbar-expand fixed-top" role="navigation"> <a class="navbar-brand logo" href="https://www.stubbornjava.com/"> <span class="align-middle"><img src="./Lazy loading and caching objects in Java with Guava&#39;s Suppliers.memoize_files/PenguinHQ_compressed.png" height="40px"> Stubborn<span class="java">Java</span></span> </a> <div class="navbar-nav mr-auto"> <div class="dropdown"> <a class="nav-item nav-link dropdown-toggle" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> Guides </a> <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink"> <a class="dropdown-item" href="https://www.stubbornjava.com/guides/embedded-java-web-server">Embedded Java Web Server</a> </div> </div> </div> <div class="header-social"> <div class="followus">Follow</div> <a href="https://twitter.com/StubbornJava"><i class="fa fa-twitter" aria-hidden="true"></i></a> <a href="https://github.com/StubbornJava/StubbornJava"><i class="fa fa-github" aria-hidden="true"></i></a> <a rel="alternate" type="application/rss+xml" title="StubbornJava" href="https://www.stubbornjava.com/rss/feed"><i class="fa fa-rss" aria-hidden="true"></i></a> </div> </nav> <div class="container"> <div class="row"> <div class="col-md-12 col-lg-9"> <h1 class="anchored" id="lazy-loading-and-caching-objects-in-java-with-guavas-suppliers-m"><a class="anchorjs-link " href="https://www.stubbornjava.com/posts/lazy-loading-and-caching-objects-in-java-with-guava-s-suppliers-memoize#lazy-loading-and-caching-objects-in-java-with-guavas-suppliers-m" aria-label="Anchor link for: lazy loading and caching objects in java with guavas suppliers m" data-anchorjs-icon="" style="font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 1em; line-height: inherit; font-family: anchorjs-icons; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>Lazy loading and caching objects in Java with Guava's Suppliers.memoize</h1> <div class="post-meta"> <span><i class="fa fa-calendar"></i>Sep 06, 2017</span> </div> <div class="post-meta-block"> <span class="bold">Tags/Libraries:</span> &nbsp; <a href="https://www.stubbornjava.com/tags/Caching/posts" class="btn btn-sm btn-default tag">Caching</a> <a href="https://www.stubbornjava.com/java-libraries/Guava" class="btn btn-sm btn-default lib">Guava</a> <div class="post-content anchored-md"><div class="anchored-md"> <p>Lazy loading and caching are extremely useful tools in the developer toolbox, like most tools they can be often overused / abused so use them sparingly. Lazy loading can be useful when creating a singleton with any variety of double checked locking, static holder class, enum singleton pattern, etc. Lazy loading is also great for expensive operations that you only need to handle some of the time. Hibernate heavily utilizes lazy loading. Lazy loading can either be request scoped or in a more global scope. Google's Guava provides an extremely convenient way to create lazy loaded values as well as caching individual values with or without an expiration.</p> <h2 id="supplier"><a class="anchorjs-link " href="https://www.stubbornjava.com/posts/lazy-loading-and-caching-objects-in-java-with-guava-s-suppliers-memoize#supplier" aria-label="Anchor link for: supplier" data-anchorjs-icon="" style="font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 1em; line-height: inherit; font-family: anchorjs-icons; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>Supplier</h2> <p>We will be using a very simple "hello world" <code>Supplier</code> that will log every time it is called.</p> <div class="code-toolbar"><pre class="line-numbers language-java" data-start="15" style="counter-reset: linenumber 14;"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">helloWorldSupplier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"supplying"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">"hello world"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Java</span></div></div></div> <div> <div class="code-gh-link pull-right"> <a href="https://github.com/StubbornJava/StubbornJava/blob/master/stubbornjava-examples/src/main/java/com/stubbornjava/examples/common/SuppliersExamples.java#L15"> <i class="fa fa-github" aria-hidden="true"></i> View on GitHub </a> </div> <div class="clearfix"></div> </div> <h2 id="suppliers-memoize"><a class="anchorjs-link " href="https://www.stubbornjava.com/posts/lazy-loading-and-caching-objects-in-java-with-guava-s-suppliers-memoize#suppliers-memoize" aria-label="Anchor link for: suppliers memoize" data-anchorjs-icon="" style="font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 1em; line-height: inherit; font-family: anchorjs-icons; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>Suppliers.memoize</h2> <p><code>Suppliers.memoize</code> is a simple method that takes a <code>Supplier</code> and returns a new <code>Supplier</code> that caches the value returned from the supplied <code>Supplier.get()</code> method. This convenient helper allows us to turn any <code>Supplier</code> into a lazily loaded cached value. The returned <code>Supplier</code> is thread-safe backed with double checked locking and volatile fields. It even allows the original <code>Supplier</code> to be garbage collected once it has been called. If you are utilizing this pattern for code that is not multi-threaded it might be useful to make a non thread-safe version.</p> <div class="code-toolbar"><pre class="line-numbers language-java" data-start="23" style="counter-reset: linenumber 22;"><code class="language-java">log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Memoized"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> memoized <span class="token operator">=</span> <span class="token class-name">Suppliers</span><span class="token punctuation">.</span><span class="token function">memoize</span><span class="token punctuation">(</span><span class="token class-name">SuppliersExamples</span><span class="token operator">::</span><span class="token function">helloWorldSupplier</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>memoized<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>memoized<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Java</span></div></div></div> <div> <div class="code-gh-link pull-right"> <a href="https://github.com/StubbornJava/StubbornJava/blob/master/stubbornjava-examples/src/main/java/com/stubbornjava/examples/common/SuppliersExamples.java#L23"> <i class="fa fa-github" aria-hidden="true"></i> View on GitHub </a> </div> <div class="clearfix"></div> </div> <div class="code-toolbar"><pre class="line-numbers language-text"><code class="language-text">2017-09-06 08:50:58.069 [main] INFO  c.s.e.common.SuppliersExamples - Memoized
2017-09-06 08:50:58.156 [main] INFO  c.s.e.common.SuppliersExamples - supplying
2017-09-06 08:50:58.157 [main] INFO  c.s.e.common.SuppliersExamples - hello world
2017-09-06 08:50:58.157 [main] INFO  c.s.e.common.SuppliersExamples - hello world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Text</span></div></div></div> <h2 id="suppliers-memoizewithexpiration"><a class="anchorjs-link " href="https://www.stubbornjava.com/posts/lazy-loading-and-caching-objects-in-java-with-guava-s-suppliers-memoize#suppliers-memoizewithexpiration" aria-label="Anchor link for: suppliers memoizewithexpiration" data-anchorjs-icon="" style="font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 1em; line-height: inherit; font-family: anchorjs-icons; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a>Suppliers.memoizeWithExpiration</h2> <p><code>Suppliers.memoizeWithExpiration</code> is also straightforward. It allows us to memoize a value from a given <code>Supplier</code> but have it update anytime we exceed the expiration time. This is a great caching mechanism for any data you know changes infrequently. A minor drawback is if the operation is expensive you may see a hiccup every time the object needs to be reloaded. Often times this is not a major concern. If it is an issue you can investigate refreshing the object asynchronously with a background thread. <code>Suppliers.memoizeWithExpiration</code> is used to cache the scraped results for our <a href="https://www.stubbornjava.com/best-selling-html-css-themes-and-website-templates">HTML / CSS Themes</a> page and can be seen in the <a href="https://www.stubbornjava.com/posts/web-scraping-in-java-using-jsoup-and-okhttp#theme-service-layer">Web scraping in Java with jsoup and OkHttp</a>.</p> <div class="code-toolbar"><pre class="line-numbers language-java" data-start="30" style="counter-reset: linenumber 29;"><code class="language-java">log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Memoized with Expiration"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> memoizedExpiring <span class="token operator">=</span> <span class="token class-name">Suppliers</span><span class="token punctuation">.</span><span class="token function">memoizeWithExpiration</span><span class="token punctuation">(</span>
    <span class="token class-name">SuppliersExamples</span><span class="token operator">::</span><span class="token function">helloWorldSupplier</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>memoizedExpiring<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>memoizedExpiring<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"sleeping"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>memoizedExpiring<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>memoizedExpiring<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"sleeping"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>memoizedExpiring<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>memoizedExpiring<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Java</span></div></div></div> <div> <div class="code-gh-link pull-right"> <a href="https://github.com/StubbornJava/StubbornJava/blob/master/stubbornjava-examples/src/main/java/com/stubbornjava/examples/common/SuppliersExamples.java#L30"> <i class="fa fa-github" aria-hidden="true"></i> View on GitHub </a> </div> <div class="clearfix"></div> </div> <div class="code-toolbar"><pre class="line-numbers language-text"><code class="language-text">2017-09-06 08:50:58.157 [main] INFO  c.s.e.common.SuppliersExamples - Memoized with Expiration
2017-09-06 08:50:58.171 [main] INFO  c.s.e.common.SuppliersExamples - supplying
2017-09-06 08:50:58.171 [main] INFO  c.s.e.common.SuppliersExamples - hello world
2017-09-06 08:50:58.171 [main] INFO  c.s.e.common.SuppliersExamples - hello world
2017-09-06 08:50:58.171 [main] INFO  c.s.e.common.SuppliersExamples - sleeping
2017-09-06 08:50:58.272 [main] INFO  c.s.e.common.SuppliersExamples - supplying
2017-09-06 08:50:58.272 [main] INFO  c.s.e.common.SuppliersExamples - hello world
2017-09-06 08:50:58.272 [main] INFO  c.s.e.common.SuppliersExamples - hello world
2017-09-06 08:50:58.272 [main] INFO  c.s.e.common.SuppliersExamples - sleeping
2017-09-06 08:50:58.377 [main] INFO  c.s.e.common.SuppliersExamples - supplying
2017-09-06 08:50:58.377 [main] INFO  c.s.e.common.SuppliersExamples - hello world
2017-09-06 08:50:58.377 [main] INFO  c.s.e.common.SuppliersExamples - hello world<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div class="toolbar"><div class="toolbar-item"><span>Text</span></div></div></div> </div> </div> </div> </div> <div class="col-lg-3 hidden-sm hidden-xs"> <div class="tag-cloud"> <h6><span><i class="fa fa-envelope theme-color" aria-hidden="true"></i> Subscribe For Updates</span></h6> <div id="mc_embed_signup"> <form action="https://stubbornjava.us16.list-manage.com/subscribe/post?u=45f8cd519c8d1109045f3ca3b&amp;id=05c0e98feb" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate=""> <div id="mc_embed_signup_scroll"> <div class="mc-field-group"> <input type="email" placeholder="Email" value="" name="EMAIL" class="form-control subscribe-email" id="mce-EMAIL"> </div> <div id="mce-responses" class="clear"> <div class="response" id="mce-error-response" style="display:none"></div> <div class="response" id="mce-success-response" style="display:none"></div> </div> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_45f8cd519c8d1109045f3ca3b_7fa124d84d" tabindex="-1" value=""></div> <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="subscribe-btn fade show"></div> </div> </form> </div> </div> <div class="tag-cloud"> <h6><span><i class="fa fa-bullhorn theme-color" aria-hidden="true"></i> Recommendations</span></h6> <ul class="list-unstyled"> <li><a href="https://www.stubbornjava.com/java-libraries">Java Libraries</a></li> <li><a href="https://www.stubbornjava.com/best-selling-html-css-themes-and-website-templates">HTML / CSS Themes</a></li> </ul> </div> <div class="tag-cloud"> <h6><span><i class="fa fa-comment theme-color" aria-hidden="true"></i> Recent Posts</span></h6> <ul class="list-unstyled"> <li> <div> <a href="https://www.stubbornjava.com/posts/creating-a-non-blocking-delay-in-the-undertow-web-server-for-artificial-latency">Creating a non-blocking delay in the Undertow Web Server for Artificial Latency</a> </div> <div class="date">Mar 13, 2019</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/grafana-cloud-dropwizard-metrics-reporter">Grafana Cloud Dropwizard Metrics Reporter</a> </div> <div class="date">Jan 01, 2019</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/increasing-resiliency-with-circuit-breakers-in-your-undertow-web-server-with-failsafe">Increasing Resiliency with Circuit Breakers in your Undertow Web Server with Failsafe</a> </div> <div class="date">Feb 05, 2018</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/configuring-security-headers-in-undertow">Configuring Security Headers in Undertow</a> </div> <div class="date">Jan 17, 2018</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/installing-java-supervisord-and-other-service-dependencies-with-ansible">Installing Java, supervisord, and other service dependencies with Ansible</a> </div> <div class="date">Nov 17, 2017</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/creating-a-local-development-environment-with-docker-compose">Creating a local development environment with Docker Compose</a> </div> <div class="date">Oct 24, 2017</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/creating-a-somewhat-deterministic-jackson-objectmapper">Creating a somewhat deterministic Jackson ObjectMapper</a> </div> <div class="date">Sep 26, 2017</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/sharing-routes-and-running-multiple-java-services-in-a-single-jvm-with-undertow">Sharing routes and running multiple Java services in a single JVM with Undertow</a> </div> <div class="date">Sep 04, 2017</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/typesafe-config-features-and-example-usage">Typesafe Config Features and Example Usage</a> </div> <div class="date">Aug 15, 2017</div> </li> <li> <div> <a href="https://www.stubbornjava.com/posts/hashing-passwords-in-java-with-bcrypt">Hashing Passwords in Java with BCrypt</a> </div> <div class="date">Aug 01, 2017</div> </li> </ul> </div> </div> </div> </div> <div class="footer"> <footer> <div class="container"> <p class="pull-left"><a href="https://www.stubbornjava.com/">StubbornJava</a> © 2017</p> <div class="clearfix"></div> </div> </footer> </div>  </body></html>